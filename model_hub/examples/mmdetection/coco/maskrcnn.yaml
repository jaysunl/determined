name: mmdet_maskrcnn
data:
  file_client_args:
      backend: gcs
      bucket_name: determined-ai-mmdet-data
      #backend: s3
      #bucket_name: fill_in
      #backend: fake
profiling:
  enabled: true
  begin_on_batch: 200
  end_after_batch: 300
hyperparameters:
  global_batch_size: 16
  validation_batch_size_per_gpu: 2
  config_file: /mmdetection/configs/mask_rcnn/mask_rcnn_r50_caffe_fpn_1x_coco.py
  merge_config: null
  use_pretrained: false
  use_apex_amp: false
  clip_grads: true
  clip_grads_norm: 35
  override_config_fields:
      #data.train.ann_file: /tmp/instances_train2017.json
      #data.val.ann_file: /tmp/instances_val2017.json
      data.workers_per_gpu: 2

checkpoint_storage:
  save_trial_latest: 5
min_validation_period:
  batches: 7320
searcher:
  name: single
  metric: bbox_mAP
  max_length:
    batches: 87850
  smaller_is_better: false
max_restarts: 0
environment:
  image: 
    gpu: liamdetermined/development:model-hub-mmdetection
  environment_variables:
      - OMP_NUM_THREADS=1
        #force_pull_image: true

bind_mounts:
    - host_path: /tmp
      container_path: /data
resources:
  slots_per_trial: 8 # max number of GPUs a trial is allowed to individually use
  shm_size: 200000000000
entrypoint: model_hub.mmdetection:MMDetTrial
